<!DOCTYPE HTML>

<html>
	<head>
		<title>情感分析系统</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/static/css/main.css" />
		<noscript><link rel="stylesheet" href="/static/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="logo">
							<span class="icon fa-gem"></span>
						</div>
						<div class="content">
							<div class="inner">
								<h1>情感分析系统</h1>
								<p>自动从社交媒体、客户评论等文本数据中识别用户情感倾向，帮助企业及时把握市场反馈、提升客户满意度，并进行舆情管理</p>
                            </div>
						</div>
						<nav>
							<ul>
                                <li><a href="#intro">项目介绍</a></li>
                                <li><a href="#text_analysis">文本分析</a></li>
                                <!-- <li><a href="{{ url_for('page.spider_analysis') }}">爬虫分析</a></li> -->
                                <li><a href="#topic_analysis">爬虫分析</a></li>
                                <li><a href="#gpt_suggestion">AI建议</a></li>
                                <!-- <li><a href="#contact">联系我们</a></li>-->
								<!--<li><a href="#elements">Elements</a></li>-->
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<div id="main">

						<!-- Intro -->
							<article id="intro">
								<h2 class="major">项目介绍</h2>
								<span class="image main"><img src="/static/images/pic04.jpg" alt="" /></span>
								<p>随着社交媒体和在线评论平台的迅猛发展，用户在社交网络、电子商务网站、论坛等平台上发布大量的文本评论和反馈。</p>
								<p>系统实现目标为对用户输入的想要分析的微博词条网址链接里的文字数据进行情感分析，然后得出关于该微博词条的情感是正向，负向还是中立结果，并给出关于该词条的文字数据的词云图。</p>
							</article>

						<!-- Contact -->
                            <article id="contact">
                                <h2 class="major">联系我们</h2>
                                <form id="contactForm" method="post">
                                    <div class="fields">
                                        <div class="field half">
                                            <label for="name">名字</label>
                                            <input type="text" name="name" id="name" required />
                                        </div>
                                        <div class="field half">
                                            <label for="email">邮箱</label>
                                            <input type="email" name="email" id="email" required />
                                        </div>
                                        <div class="field">
                                            <label for="message">信息</label>
                                            <textarea name="message" id="message" rows="4" required></textarea>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><input type="submit" value="发送信息" class="primary" /></li>
                                        <li><input type="reset" value="重置" /></li>
                                    </ul>
                                </form>

                                <ul class="icons">
									<li><a href="https://github.com/TheteamofP/Emotion-Analysis-Project" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
								</ul>
                            </article>

                        <!-- 文本分析 -->
                            <article id="text_analysis">
                                <h2 class="major">文本分析</h2>
                                <form id="singleAnalysisForm" method="post">
                                    <div class="fields">
                                        <div class="field">
                                            <label for="single_text">要分析的文本</label>
                                            <textarea id="single_text" name="text" required style="overflow: hidden"></textarea>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><button type="submit">开始分析</button></li>
                                    </ul>
                                </form>
                                <div id="single_result"></div>
                            </article>


                         <!-- 话题分析 -->
                          <article id="topic_analysis">
                                <h2 class="major">话题分析</h2>
                                <form id="topicAnalysisForm" method="post">
                                    <div class="fields">
                                        <div class="field">
                                            <label for="topic_url">话题链接</label>
                                            <input type="text" id="topic_url" name="url" required>
                                            <div class="url-preview-container">
                                                <span class="preview-label">URL 预览</span>
                                                <div id="topic_url_preview" class="url-preview empty">等待输入...</div>
                                                <div id="topic_url_validation" class="validation-message"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><button type="submit" id="topic_submit" disabled>开始分析</button></li>
                                    </ul>

                                </form>
                                <div id="topic_result"></div>

                            </article>


                        <!-- AI 建议 -->
                            <article id="gpt_suggestion">
                                <h2 class="major">AI 建议</h2>
                                <div id="chat-container" class="chat-container"></div>
                                <div id="typing-indicator" class="typing-indicator">AI 正在思考...</div>
                                <form id="gpt-form">
                                    <div class="fields">
                                        <div class="field">
                                            <label for="text">输入消息</label>
                                            <textarea id="text" name="text" rows="3" style="height: 300px" placeholder="请输入您的问题...">{{ preset_text }}</textarea>
                                        </div>
                                    </div>
                                    <div class="actions">
                                        <button type="submit">发送消息</button>
                                        <button type="button" id="clear-chat">清空对话</button>
                                    </div>
                                </form>
                            </article>



						<!-- Elements -->
							<article id="elements">
								<h2 class="major">Elements</h2>

								<section>
									<h3 class="major">Text</h3>
									<p>This is <b>bold</b> and this is <strong>strong</strong>. This is <i>italic</i> and this is <em>emphasized</em>.
									This is <sup>superscript</sup> text and this is <sub>subscript</sub> text.
									This is <u>underlined</u> and this is code: <code>for (;;) { ... }</code>. Finally, <a href="#">this is a link</a>.</p>
									<hr />
									<h2>Heading Level 2</h2>
									<h3>Heading Level 3</h3>
									<h4>Heading Level 4</h4>
									<h5>Heading Level 5</h5>
									<h6>Heading Level 6</h6>
									<hr />
									<h4>Blockquote</h4>
									<blockquote>Fringilla nisl. Donec accumsan interdum nisi, quis tincidunt felis sagittis eget tempus euismod. Vestibulum ante ipsum primis in faucibus vestibulum. Blandit adipiscing eu felis iaculis volutpat ac adipiscing accumsan faucibus. Vestibulum ante ipsum primis in faucibus lorem ipsum dolor sit amet nullam adipiscing eu felis.</blockquote>
									<h4>Preformatted</h4>
									<pre><code>i = 0;

                                        while (!deck.isInOrder()) {
                                            print 'Iteration ' + i;
                                            deck.shuffle();
                                            i++;
                                        }

                                        print 'It took ' + i + ' iterations to sort the deck.';</code></pre>
								</section>

								<section>
									<h3 class="major">Lists</h3>

									<h4>Unordered</h4>
									<ul>
										<li>Dolor pulvinar etiam.</li>
										<li>Sagittis adipiscing.</li>
										<li>Felis enim feugiat.</li>
									</ul>

									<h4>Alternate</h4>
									<ul class="alt">
										<li>Dolor pulvinar etiam.</li>
										<li>Sagittis adipiscing.</li>
										<li>Felis enim feugiat.</li>
									</ul>

									<h4>Ordered</h4>
									<ol>
										<li>Dolor pulvinar etiam.</li>
										<li>Etiam vel felis viverra.</li>
										<li>Felis enim feugiat.</li>
										<li>Dolor pulvinar etiam.</li>
										<li>Etiam vel felis lorem.</li>
										<li>Felis enim et feugiat.</li>
									</ol>
									<h4>Icons</h4>
									<ul class="icons">
										<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
									</ul>

									<h4>Actions</h4>
									<ul class="actions">
										<li><a href="#" class="button primary">Default</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
									<ul class="actions stacked">
										<li><a href="#" class="button primary">Default</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
								</section>

								<section>
									<h3 class="major">Table</h3>
									<h4>Default</h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Name</th>
													<th>Description</th>
													<th>Price</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Item One</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Two</td>
													<td>Vis ac commodo adipiscing arcu aliquet.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Three</td>
													<td> Morbi faucibus arcu accumsan lorem.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Four</td>
													<td>Vitae integer tempus condimentum.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Five</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
											</tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td>100.00</td>
												</tr>
											</tfoot>
										</table>
									</div>

									<h4>Alternate</h4>
									<div class="table-wrapper">
										<table class="alt">
											<thead>
												<tr>
													<th>Name</th>
													<th>Description</th>
													<th>Price</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Item One</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Two</td>
													<td>Vis ac commodo adipiscing arcu aliquet.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Three</td>
													<td> Morbi faucibus arcu accumsan lorem.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Four</td>
													<td>Vitae integer tempus condimentum.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Five</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
											</tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td>100.00</td>
												</tr>
											</tfoot>
										</table>
									</div>
								</section>

								<section>
									<h3 class="major">Buttons</h3>
									<ul class="actions">
										<li><a href="#" class="button primary">Primary</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
									<ul class="actions">
										<li><a href="#" class="button">Default</a></li>
										<li><a href="#" class="button small">Small</a></li>
									</ul>
									<ul class="actions">
										<li><a href="#" class="button primary icon solid fa-download">Icon</a></li>
										<li><a href="#" class="button icon solid fa-download">Icon</a></li>
									</ul>
									<ul class="actions">
										<li><span class="button primary disabled">Disabled</span></li>
										<li><span class="button disabled">Disabled</span></li>
									</ul>
								</section>

								<section>
									<h3 class="major">Form</h3>
									<form method="post" action="#">
										<div class="fields">
											<div class="field half">
												<label for="demo-name">Name</label>
												<input type="text" name="demo-name" id="demo-name" value="" placeholder="Jane Doe" />
											</div>
											<div class="field half">
												<label for="demo-email">Email</label>
												<input type="email" name="demo-email" id="demo-email" value="" placeholder="jane@untitled.tld" />
											</div>
											<div class="field">
												<label for="demo-category">Category</label>
												<select name="demo-category" id="demo-category">
													<option value="">-</option>
													<option value="1">Manufacturing</option>
													<option value="1">Shipping</option>
													<option value="1">Administration</option>
													<option value="1">Human Resources</option>
												</select>
											</div>
											<div class="field half">
												<input type="radio" id="demo-priority-low" name="demo-priority" checked>
												<label for="demo-priority-low">Low</label>
											</div>
											<div class="field half">
												<input type="radio" id="demo-priority-high" name="demo-priority">
												<label for="demo-priority-high">High</label>
											</div>
											<div class="field half">
												<input type="checkbox" id="demo-copy" name="demo-copy">
												<label for="demo-copy">Email me a copy</label>
											</div>
											<div class="field half">
												<input type="checkbox" id="demo-human" name="demo-human" checked>
												<label for="demo-human">Not a robot</label>
											</div>
											<div class="field">
												<label for="demo-message">Message</label>
												<textarea name="demo-message" id="demo-message" placeholder="Enter your message" rows="6"></textarea>
											</div>
										</div>
										<ul class="actions">
											<li><input type="submit" value="Send Message" class="primary" /></li>
											<li><input type="reset" value="Reset" /></li>
										</ul>
									</form>
								</section>

							</article>

					</div>

				<!-- Footer -->
                <footer id="footer">
                    <p class="copyright">&copy; 2024 情感分析系统</p>
                </footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>

		<!-- Scripts -->
			<script src="/static/js/jquery.min.js"></script>
			<script src="/static/js/browser.min.js"></script>
			<script src="/static/js/breakpoints.min.js"></script>
			<script src="/static/js/util.js"></script>
			<script src="/static/js/main.js"></script>

            <script>
                  const singleAnalysisUrl = "{{ url_for('page.text_analysis_single') }}";
                  const batchAnalysisUrl = "{{ url_for('page.text_analysis_batch') }}";
            </script>
            <script src="/static/js/analysis.js"></script>

            <script>
                const gptSuggestionUrl = "{{ url_for('page.gpt_suggestion') }}";
            </script>
            <script src="/static/js/gptChat.js"></script>

            <!-- 添加JavaScript处理表单提交 -->
            <script>
            document.getElementById('contactForm').addEventListener('submit', function(e) {
                e.preventDefault(); // 阻止默认提交

                const formData = new FormData(this);

                // 显示加载状态
                const submitButton = this.querySelector('input[type="submit"]');
                const originalValue = submitButton.value;
                submitButton.value = '发送中...';
                submitButton.disabled = true;

                fetch('{{ url_for("page.contact") }}', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    alert('信息发送成功！');
                    this.reset(); // 重置表单
                })
                .catch(error => {
                    alert('发送失败，请重试。');
                    console.error('Error:', error);
                })
                .finally(() => {
                    // 恢复按钮状态
                    submitButton.value = originalValue;
                    submitButton.disabled = false;
                });
            });
            </script>


            <!-- topic -->
            <script>
                function validateUrl(url) {
                    try {
                        const urlObj = new URL(url);
                        return urlObj.protocol === 'http:' || urlObj.protocol === 'https:';
                    } catch (e) {
                        return false;
                    }
                }

                function setupUrlValidation(inputId, previewId, validationId, submitButtonId) {
                    const input = document.getElementById(inputId);
                    const preview = document.getElementById(previewId);
                    const validation = document.getElementById(validationId);
                    const submitButton = document.getElementById(submitButtonId);

                    let timeoutId;

                    input.addEventListener('input', function() {
                        clearTimeout(timeoutId);
                        timeoutId = setTimeout(() => {
                            const url = this.value.trim();

                            if (url === '') {
                                preview.textContent = '等待输入...';
                                preview.className = 'url-preview empty';
                                validation.className = 'validation-message';
                                validation.textContent = '';
                                submitButton.disabled = true;
                                return;
                            }

                            preview.textContent = url;
                            preview.className = 'url-preview';

                            const isValid = validateUrl(url);
                            preview.className = 'url-preview ' + (isValid ? 'valid' : 'invalid');
                            validation.className = 'validation-message ' + (isValid ? 'valid' : 'invalid');
                            validation.textContent = isValid ? 'URL格式正确' : 'URL格式不正确';
                            submitButton.disabled = !isValid;
                        }, 300);
                    });
                }

                $(document).ready(function() {
                    // 设置URL验证
                    setupUrlValidation('topic_url', 'topic_url_preview', 'topic_url_validation', 'topic_submit');


                    $('#topicAnalysisForm').on('submit', function(event) {
                        event.preventDefault();
                        var formData = $(this).serialize();

                        $.ajax({
                            type: 'POST',
                            url: '{{ url_for("page.spider_analysis_topic") }}',
                            data: formData,
                            success: function(response) {
                                console.log("话题分析返回的数据：", response);
                                if(response.error) {
                                    $('#topic_result').html('<h3 class="error">' + response.error + '</h3>');
                                } else {
                                    // 构建并显示话题分析结果
                                    let resultHTML = '<h3>话题分析结果:</h3>';
                                    resultHTML += '<div class="result-content">';
                                    resultHTML += '<p>分析链接: ' + response.result.url + '</p>';
                                    resultHTML += '<p>讨论数量: ' + response.result.discussion_count + '</p>';
                                    resultHTML += '<p>参与人数: ' + response.result.participant_count + '</p>';
                                    resultHTML += '<p>话题热度: ' + response.result.popularity_score + '</p>';
                                    resultHTML += '<p>情感倾向: ' + response.result.sentiment + '</p>';
                                    resultHTML += '</div>';

                                    resultHTML += '<button id="gpt_suggest" style="display:block;">点击查看AI助手建议</button>';
                                    $('#topic_result').html(resultHTML);

                                    // 为新添加的按钮绑定点击事件处理函数
                                   $('#gpt_suggest').on('click', function() {
                                        var resultText = $('#topic_result .result-content').text();
                                        var suggestionText = "话题分析结果：\n" + resultText + "\n请对此进行分析和建议";

                                        window.open('{{ url_for("home") }}?text=' + encodeURIComponent(suggestionText) + '#gpt_suggestion', '_blank');
                                        document.querySelector('#gpt_suggestion').scrollIntoView({ behavior: 'smooth' });
                                    });
                                }
                            },
                            error: function(xhr) {
                                $('#topic_result').html('<h3 class="error">分析失败，请重试</h3>');
                            }
                        });
                    });
                });
            </script>


	</body>
</html>
