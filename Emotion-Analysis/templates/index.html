<!DOCTYPE HTML>

<html>
	<head>
		<title>情感分析系统</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/static/css/main.css" />
		<noscript><link rel="stylesheet" href="/static/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="logo">
							<span class="icon fa-gem"></span>
						</div>
						<div class="content">
							<div class="inner">
								<h1>情感分析系统</h1>
								<p>自动从社交媒体、客户评论等文本数据中识别用户情感倾向，帮助企业及时把握市场反馈、提升客户满意度，并进行舆情管理</p>
                            </div>
						</div>
						<nav>
							<ul>
                                <li><a href="#intro">项目介绍</a></li>
                                <li><a href="#text_analysis">文本分析</a></li>
                                <li><a href="#topic_analysis">爬虫分析</a></li>
                                <li><a href="#gpt_suggestion">AI建议</a></li>
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<div id="main">

						<!-- Intro -->
							<article id="intro">
								<h2 class="major">项目介绍</h2>
								<span class="image main"><img src="/static/images/pic04.jpg" alt="" /></span>
								<p>随着社交媒体和在线评论平台的迅猛发展，用户在社交网络、电子商务网站、论坛等平台上发布大量的文本评论和反馈。</p>
								<p>系统实现目标为对用户输入的想要分析的微博词条网址链接里的文字数据进行情感分析，然后得出关于该微博词条的情感是正向，负向还是中立结果，并给出关于该词条的文字数据的词云图。</p>
							</article>


                        <!-- 文本分析 -->
                            <article id="text_analysis">
                                <h2 class="major">文本分析</h2>
                                <form id="singleAnalysisForm" method="post">
                                    <div class="fields">
                                        <div class="field">
                                            <label for="single_text">要分析的文本</label>
                                            <textarea id="single_text" name="text" required style="overflow: hidden"></textarea>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><button type="submit" id="text_submit" disabled>开始分析</button></li>
                                    </ul>
                                </form>
                                <div id="single_result"></div>
                            </article>


                         <!-- 话题分析 -->
                            <article id="topic_analysis">
                                <h2 class="major">话题分析</h2>
                                <form id="topicAnalysisForm" method="post">
                                    <div class="fields">
                                        <div class="field">
                                            <label for="topic_cookie">COOKIE</label>
                                            <input type="text" id="topic_cookie" name="cookie" required>
                                        </div>
                                        <div class="field">
                                            <label for="topic_keyword">关键词</label>
                                            <input type="text" id="topic_keyword" name="keyword" required>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><button type="submit" id="topic_submit" disabled>开始分析</button></li>
                                    </ul>
                                </form>
                                <div id="topic_result"></div>
                            </article>

                         <!-- AI 建议 -->
                            <article id="gpt_suggestion">
                                <h2 class="major">AI 建议</h2>
                                <div id="chat-container" class="chat-container"></div>
                                <div id="typing-indicator" class="typing-indicator">AI 正在思考...</div>
                                <form id="gpt-form">
                                    <div class="fields">
                                        <div class="field">
                                            <label for="text">输入消息</label>
                                            <textarea id="text" name="text" rows="3" style="height: 300px" placeholder="请输入您的问题...">{{ preset_text }}</textarea>
                                        </div>
                                    </div>
                                    <div class="actions">
                                        <button type="submit">发送消息</button>
                                        <button type="button" id="clear-chat">清空对话</button>
                                    </div>
                                </form>
                            </article>



					</div>

				<!-- Footer -->
                <footer id="footer">
                    <p class="copyright">&copy; 2024 情感分析系统</p>
                </footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>

		<!-- Scripts -->
			<script src="/static/js/jquery.min.js"></script>
			<script src="/static/js/browser.min.js"></script>
			<script src="/static/js/breakpoints.min.js"></script>
			<script src="/static/js/util.js"></script>
			<script src="/static/js/main.js"></script>

            <script>
                  const singleAnalysisUrl = "{{ url_for('page.text_analysis') }}";
            </script>
            <script src="/static/js/analysis.js"></script>

            <script>
                const gptSuggestionUrl = "{{ url_for('page.gpt_suggestion') }}";
            </script>
            <script src="/static/js/gptChat.js"></script>




            <!-- topic -->
            <script>
                $(document).ready(function() {
                    const submitButton = document.getElementById('topic_submit');
                    const inputs = document.querySelectorAll('#topicAnalysisForm .field input[required]');

                    // 检查是否所有必填字段都有值
                    function checkFormValidity() {
                        const allFilled = Array.from(inputs).every(input => input.value.trim() !== '');
                        submitButton.disabled = !allFilled;
                    }

                    // 页面加载时立即检查一次按钮状态
                    checkFormValidity();

                    // 监听输入事件
                    inputs.forEach(input => {
                        input.addEventListener('input', checkFormValidity);
                    });

                    // 监听表单提交
                    $('#topicAnalysisForm').on('submit', function(event) {
                        event.preventDefault();
                        var formData = $(this).serialize();

                        $.ajax({
                            type: 'POST',
                            url: '{{ url_for("page.spider_analysis_topic") }}',
                            data: formData,
                            success: function(response) {
                                console.log("话题分析返回的数据：", response);
                                if(response.error) {
                                    $('#topic_result').html('<h3 class="error">' + response.error + '</h3>');
                                } else {
                                    // 构建并显示话题分析结果，包括词云图片
                                    let resultHTML = '<h3 class="major">话题分析结果:</h3>';
                                    resultHTML += '<div class="result-content">';
                                    resultHTML += '<p><strong>关键词:</strong> ' + response.result.keyword + '</p>';
                                    resultHTML += '<p><strong>情感倾向:</strong> ' + response.result.sentiment + '</p>';
                                    resultHTML += '</div>';

                                    // 插入词云图片
                                    resultHTML +=  '<h3 class="major">词云展示:</h3>';
                                    resultHTML += '<div class="image-grid">';
                                    resultHTML += '<div class="image"><img src="{{ url_for("static", filename="wordclouds/wordcloud_all.png") }}" alt="词云图1" class="wordcloud"></div>';
                                    resultHTML += '<div class="image"><img src="{{ url_for("static", filename="wordclouds/wordcloud_negative.png") }}" alt="词云图2" class="wordcloud"></div>';
                                    resultHTML += '<div class="image"><img src="{{ url_for("static", filename="wordclouds/wordcloud_neutral.png") }}" alt="词云图3" class="wordcloud"></div>';
                                    resultHTML += '<div class="image"><img src="{{ url_for("static", filename="wordclouds/wordcloud_positive.png") }}" alt="词云图4" class="wordcloud"></div>';
                                    resultHTML += '</div>';

                                    // 添加按钮
                                    resultHTML += '<button id="gpt_suggest" style="display:block;">点击查看AI助手建议</button>';
                                    $('#topic_result').html(resultHTML);

                                    $('#gpt_suggest').on('click', function() {
                                        var resultText = $('#topic_result .result-content').text();
                                        var suggestionText = "话题分析结果：\n" + resultText + "\n请对此进行分析和建议";

                                        window.open('{{ url_for("home") }}?text=' + encodeURIComponent(suggestionText) + '#gpt_suggestion', '_blank');
                                    });
                                }
                            },
                            error: function(xhr) {
                                $('#topic_result').html('<h3 class="error">分析失败，请重试</h3>');
                            }
                        });
                    });
                });
            </script>




	</body>
</html>
